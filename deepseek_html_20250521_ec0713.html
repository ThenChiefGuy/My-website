<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Our Site</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .privacy {
            font-size: 12px;
            color: #666;
            margin-top: 30px;
        }
        .loading {
            color: #4285f4;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome to Our Website</h1>
        <p>Thank you for visiting our site. We're loading your content...</p>
        <div id="status" class="loading">Initializing...</div>
    </div>
    <p class="privacy">By using this site, you agree to our privacy policy.</p>

    <script>
        // Your Firebase Config (replace with your actual config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Function to collect visitor data
        async function logVisitor() {
            const statusEl = document.getElementById('status');
            
            try {
                statusEl.textContent = "Collecting basic information...";
                
                // Get IP address
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const ip = ipData.ip;

                // Get additional info
                const timestamp = new Date().toISOString();
                const userAgent = navigator.userAgent;
                const referrer = document.referrer || "direct";
                const screenRes = `${window.screen.width}x${window.screen.height}`;
                const language = navigator.language;
                const pageUrl = window.location.href;

                // Prepare data object
                const visitorData = {
                    ip,
                    timestamp,
                    userAgent,
                    referrer,
                    screenRes,
                    language,
                    pageUrl,
                    // Add more fields if needed
                };

                statusEl.textContent = "Saving information...";
                
                // Save to Firebase
                const logRef = database.ref('visitors').push();
                await logRef.set(visitorData);
                
                statusEl.textContent = "Redirecting to content...";
                
                // Optional: Redirect after logging
                setTimeout(() => {
                    // Replace with your actual content page
                    window.location.href = "/content.html";
                }, 1500);

            } catch (error) {
                console.error("Error logging visitor:", error);
                statusEl.textContent = "Loading content...";
                statusEl.style.color = "#666";
                
                // Continue even if logging fails
                setTimeout(() => {
                    window.location.href = "/content.html";
                }, 1000);
            }
        }

        // Start logging when page loads
        document.addEventListener('DOMContentLoaded', logVisitor);
    </script>
</body>
</html>